<t t-name="x_project_task_worksheet_template_23">


<!-- ======== ESTILOS INTEGRADOS PARA REPORTE PDF ======== -->
<style>
   /* === BASE GENERAL === */
   body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      color: #000;
      background-color: #fff;
   } 
 
   table {
      width: 100%; 
      border-collapse: collapse;
   } 
 
   th, td {
      border: 1px solid #000;
      padding: 6px 8px;
      vertical-align: middle;
      text-align: left;
      background-color: #fff;
   }

   /* ======== ENCABEZADO PRINCIPAL ======== */
   .header-reporte {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 10px;
      table-layout: fixed; /* fuerza proporciones consistentes */
   }

   /* Banda negra superior */
   .header-reporte .titulo {
      background-color: #000;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      text-transform: uppercase;
      padding: 6px;
   }

   /* Banda roja secundaria */
   .header-reporte .subtitulo {
      background-color: #d72626;
      color: #fff;
      font-size: 13px;
      font-weight: bold;
      text-align: center;
      padding: 6px;
   }

   /* Etiquetas */
   .header-reporte .label {
      font-weight: bold;
      font-size: 12px;
      background-color: #f9f9f9;
      text-align: left;
      width: 20%;
   }

   /* Anchos de columnas */
   .header-reporte td:nth-child(1),
   .header-reporte td:nth-child(3) {
      width: 22%;
      background-color: #f9f9f9;
      font-weight: bold;
   }

   .header-reporte td:nth-child(2),
   .header-reporte td:nth-child(4) {
      width: 28%;
   }

   /* Ajuste de texto largo */
   .header-reporte td span {
      word-wrap: break-word;
      white-space: normal;
      display: block;
   }

   /* Logos */
   .header-reporte .logo {
      max-height: 60px;
      max-width: 100%;
      display: block;
      margin: 0 auto;
      object-fit: contain;
   }

   .logo {
      width: 120px;
      height: auto;
      object-fit: contain; 
      display: block;
      margin: 0 auto; 
   }

   /* ======== SECCIONES DE EVIDENCIA Y COMENTARIOS ======== */
   .evidencia-title, .comentarios-title {
      background-color: #d72626;
      color: #fff;
      font-weight: bold;
      text-transform: uppercase;
      text-align: center;
      padding: 6px;
      border: 1px solid #000;
      margin: 14px 0 8px 0;
      font-size: 13px;
   }

   /* Tarjeta de evidencia */
   .evidencia-card {
      background: #fff;
      padding: 8px;
      margin-bottom: 12px;
      page-break-inside: avoid;
      border: none;
      box-shadow: none;
   }

   /* Título de imagen */
   .img-title {
      background-color: #d72626;
      color: #fff;
      font-weight: bold;
      text-align: center;
      padding: 4px 6px;
      font-size: 12px;
      margin-bottom: 8px;
      border-bottom: 1px solid #000;
      text-transform: uppercase; 
   }

   /* Contenedor de imagen */
   .custom-image {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      overflow: hidden;
      border: none;
      padding: 0;
      background: none;
      box-shadow: none;
   } 

   .custom-image img {
      width: 100%;
      height: auto;
      object-fit: none; /* muestra la imagen completa sin recortes */
      image-orientation: from-image; /* respeta orientación original EXIF */
      transform: none; /* sin rotaciones forzadas */
      max-height: none;
      image-rendering: auto;
      display: block;
      margin: 0 auto;
   }

   /* Contenedor GPS o imagen general */
   .gps-container {
      padding: 6px;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
   }

   /* Texto de comentario */
   .comentario-text {
      border-top: 1px solid #000;
      padding-top: 6px;
      margin-top: 8px;
      background: #fff;
      white-space: pre-wrap;
      line-height: 1.35;
      font-size: 12px;
   }

   /* Etiquetas de información */
   .info-label {
      font-weight: bold;
      display: inline-block;
      min-width: 90px;
   }

   /* ======== UTILIDADES ======== */
   .text-center { text-align: center; }
   .text-right { text-align: right; }
   .mb-3 { margin-bottom: 12px; }
   .mt-4 { margin-top: 16px; }

   /* ======== CONTROL DE PÁGINA ======== */
   .pagina-sola {
      page-break-before: always;
      page-break-after: avoid;
      margin-top: 15px;
   }

   /* ======== VERSIÓN PARA IMPRESIÓN ======== */
   @media print {
      body {
         -webkit-print-color-adjust: exact;
         print-color-adjust: exact;
      }
      .gps-container { min-height: 280px; }
      .custom-image img { width: 100%; height: auto; max-height: none; }
      .evidencia-card, .header-reporte, .pagina-sola {
         page-break-inside: avoid;
      }
   }
   /* ===== BLOQUE SPT – PTI ===== */

.spt-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
}

.spt-title {
    text-align: center;
    padding: 6px;
    font-weight: bold;
    font-size: 13px;
}

.spt-cell {
    width: 50%;
    padding: 6px;
    vertical-align: top;
    text-align: center;
}

.spt-label {
    font-weight: bold;
    font-size: 11px;
    display: block;
    margin-bottom: 4px;
}

.spt-image {
    max-width: 100%;
    max-height: 220px;
    border: 1px solid #ccc;
}

/* Opcional: mejora visual en PDF */
.spt-table tr + tr td {
    padding-top: 10px;
} 

 .logo-reporte {
  display: block;
  margin: 0 auto;        /* centra horizontal */
  max-width: 160px;
  height: 60px;
  object-fit: contain;
}

  .info-central {
    text-align: center;
    font-size: 13px;
    line-height: 1.4;
  }

  .info-central .titulo {
    font-weight: bold;
    font-size: 14px;
  }
</style>





<!-- ======== IDENTIFICACIÓN DEL SITIO – REPORTE DE DAÑOS (CMR) ======== -->
<table class="header-reporte">
      <!-- Banda negra -->
  <tr>
    <th colspan="12" class="titulo">
      PHOENIX TOWER INTERNATIONAL
    </th>
  </tr>

  <!-- Banda roja -->
  <tr>
    <th colspan="12" class="subtitulo">
      REPORTE DE DAÑOS EN EL MANTENIMIENTO PREVENTIVO (CMR)
    </th>
  </tr>

<tr>
  <!-- Logo Cliente -->
  <td colspan="4" style="text-align:left; vertical-align:middle;">
    <t t-if="worksheet.x_studio_logo_cliente">
      <img class="logo-reporte"
           t-att-src="image_data_uri(worksheet.x_studio_logo_cliente)"/>
    </t>
  </td>

  <!-- Información Central -->
  <td colspan="4" class="info-central" style="vertical-align:middle;">

    <div>
      <strong>Proveedor:</strong>
      <span t-field="worksheet.x_studio_proveedor"/>
    </div>
    <div>
      <strong>Tipo de mantenimiento:</strong>
      <span t-field="worksheet.x_studio_tipo_de_mantenimiento"/>
    </div>
  </td>

  <!-- Logo Compañía -->
  <td colspan="4" style="text-align:right; vertical-align:middle;">
    <t t-if="worksheet.x_studio_logo_compaia">
      <img class="logo-reporte"
           t-att-src="image_data_uri(worksheet.x_studio_logo_compaia)"/>
    </t>
    <t t-else="">
      <img class="logo-reporte"
           src="https://www.gh3.cl/images/gh3_final_logo_RGB.png"/>
    </t>
  </td>
</tr>


</table>

<table class="header-reporte">
  <tr>
    <th colspan="12" class="subtitulo">IDENTIFICACIÓN DEL SITIO</th>
  </tr>
</table>

<!-- ======== INFORMACIÓN GENERAL ======== -->
<table class="header-reporte">

  <tr>
    <td class="label">ID Cliente:</td>
    <td><span t-field="worksheet.x_studio_id_cliente"/></td>

    <td class="label">Nombre del Sitio:</td>
    <td><span t-field="worksheet.x_studio_nombre_del_sitio"/></td>
  </tr>

  <tr>
    <td class="label">Dirección:</td>
    <td><span t-field="worksheet.x_studio_direccin"/></td>

    <td class="label">Tipo de Sitio:</td>
    <td><span t-field="worksheet.x_studio_tipo_de_sitio"/></td>
  </tr>

  <tr>
    <td class="label">Tipo de Torre:</td>
    <td><span t-field="worksheet.x_studio_tipo_de_torre"/></td>

    <td class="label">Altura de Torre (m):</td>
    <td><span t-field="worksheet.x_studio_altura_torre"/></td>
  </tr>

  <tr>
    <td class="label">Latitud:</td>
    <td>
      <span t-field="worksheet.x_studio_latitud"
            t-options="{&quot;digits&quot;:[12,6]}"/>
    </td>

    <td class="label">Longitud:</td>
    <td>
      <span t-field="worksheet.x_studio_longitud"
            t-options="{&quot;digits&quot;:[12,6]}"/>
    </td>
  </tr>

<tr>
  <td class="label">Fecha Inicio:</td>
  <td>
    <span t-field="worksheet.x_studio_fecha"
          t-options='{"widget": "date"}'/>
  </td>

  <td class="label">Fecha Término:</td>
  <td>
    <span t-field="worksheet.x_studio_fecha_termino"
          t-options='{"widget": "date"}'/>
  </td>
</tr>

</table>
<!-- ======================= REPORTE DE DAÑOS (CMR) ======================= -->
<!-- ======================= REPORTE DE DAÑOS (CMR) ======================= -->
<table class="header-reporte">
  <tr>
    <th colspan="12" class="subtitulo">REPORTE DE DAÑOS (CMR)</th>
  </tr>
</table>

<table class="header-reporte">

  <tr>
    <th style="width:5%">#</th>
    <th style="width:80%">Detalle del Daño / Comentario</th>
    <th style="width:15%">Prioridad</th>
  </tr>

  <!-- Inicializamos contador -->
  <t t-set="contador" t-value="0"/>

  <!-- Si existen daños -->
  <t t-if="worksheet.x_studio_registro_de_daos">
    <t t-foreach="worksheet.x_studio_registro_de_daos" t-as="dano">

      <!-- Incrementamos contador -->
      <t t-set="contador" t-value="contador + 1"/>

      <tr>
        <!-- Número -->
        <td style="text-align:center;">
          <t t-esc="contador"/>
        </td>

        <!-- Descripción del daño -->
        <td>
          <span t-field="dano.x_name"/>
        </td>

        <!-- Prioridad -->
        <td style="text-align:center; font-weight:bold;">
          <span t-field="dano.x_studio_prioridad"/>
        </td>
      </tr>

    </t>
  </t>

  <!-- Sin registros -->
  <t t-if="not worksheet.x_studio_registro_de_daos">
    <tr>
      <td colspan="3"
          style="text-align:center; font-style:italic;">
        No se registran daños durante la inspección.
      </td>
    </tr>
  </t>

</table>
<!-- ===================== SECCIÓN: EVIDENCIA REPORTE DE DAÑOS ===================== -->
<div class="pagina-sola" style="page-break-before: always; margin-top:20px;">

  <!-- ================== IMÁGENES REPORTE DE DAÑOS ================== -->
  <t t-set="imagenes_reporte_danos" t-value="[
        ('x_studio_evidencia_n1_2', 'Daño Evidenciado – Punto 1'),
        ('x_studio_evidencia_n2_1', 'Daño Evidenciado – Punto 2'),
        ('x_studio_evidencia_n3_1', 'Daño Evidenciado – Punto 3'),
        ('x_studio_evidencia_n4_1', 'Daño Evidenciado – Punto 4')
      ]"/>

  <!-- FILTRAR SOLO LOS CAMPOS CON IMAGEN -->
  <t t-set="imagenes_danos_validas"
     t-value="[ (campo, titulo) for campo, titulo in imagenes_reporte_danos if worksheet[campo] ]"/>

  <t t-if="imagenes_danos_validas">

    <div class="evidencia-title" style="margin:20px 0 10px 0;">
      Evidencia Fotográfica – Reporte de Daños
    </div>

    <table class="evidencias-container"
           style="width:100%; border-collapse:collapse; page-break-inside:avoid;">

      <t t-set="total_danos" t-value="len(imagenes_danos_validas)"/>

      <!-- RECORRER EN PARES -->
      <t t-foreach="range(0, total_danos, 2)" t-as="i">
        <tr>

          <!-- COLUMNA IZQUIERDA -->
          <td style="width:50%; padding:6px; vertical-align:top;">
            <t t-if="i &lt; total_danos">
              <div class="evidencia-card">
                <div class="img-title" style="text-align:center; font-size:11px;">
                  <t t-esc="imagenes_danos_validas[i][1]"/>
                </div>
                <img t-att-src="'data:image/png;base64,%s' % worksheet[imagenes_danos_validas[i][0]].decode('utf-8')"
                     style="width:100%; max-height:320px; object-fit:contain;"/>
              </div>
            </t>
          </td>

          <!-- COLUMNA DERECHA -->
          <td style="width:50%; padding:6px; vertical-align:top;">
            <t t-if="i+1 &lt; total_danos">
              <div class="evidencia-card">
                <div class="img-title" style="text-align:center; font-size:11px;">
                  <t t-esc="imagenes_danos_validas[i+1][1]"/>
                </div>
                <img t-att-src="'data:image/png;base64,%s' % worksheet[imagenes_danos_validas[i+1][0]].decode('utf-8')"
                     style="width:100%; max-height:320px; object-fit:contain;"/>
              </div>
            </t>
          </td>

        </tr>
      </t>

    </table>

  </t>

</div>





</t>
